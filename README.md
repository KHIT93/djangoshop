# Djangoshop
To create a new instance for development follow the below steps.

## Requirements
Before you continue, please make sure that you have `GraphViz` installed. It can be downloaded from here: http://www.graphviz.org/Download..php
NodeJS: https://nodejs.org/en/download/current/

Start by making sure that you have python 3 and virtualenv installed. You can follow these guides on how to get it done:
- Windows

```
https://www.codingforentrepreneurs.com/projects/start-with-windows/
```

- macOS
Please note that you only need to install virtualenv, as macOS comes with Python 3 preinstalled

```
https://www.codingforentrepreneurs.com/projects/get-with-mac/
```

- Linux
Please note that some versions of Linux have different ways to get the python tools that you need. Pleae refer to the documentation of your Linux distrubution to find out what the specific steps are for your Linux distribution
```
https://www.codingforentrepreneurs.com/projects/start-with-linux/
```

Once done, we need to download this repository and then create a virtual environment for the code to run in.
First make sure that you have a working directory like ~/Code/djangoshop and run this command:

```
git clone https://github.com/khit93/djangoshop src
```

This will download the code into a folder called src.
Next we need to install the virtual environment.
In your working directory run this command:

```
virtualenv -p python3 .
```

This wil scaffold a virtual environment inside your current working directory.
Next we need to create a local settings file, as it cannot be expected that specific settings for production are not available on the local development workstation.
The project is configured to look for a file called `local.py` inside `src/djangoshop/settings`.

You can create the file with these contents:

```
"""
Django settings for djangoshop project.

Generated by 'django-admin startproject' using Django 1.11.2.

For more information on this file, see
https://docs.djangoproject.com/en/1.11/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/1.11/ref/settings/
"""

import os

# Build paths inside the project like this: os.path.join(BASE_DIR, ...)
BASE_DIR = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/1.11/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = '3mhqz6j345btulj06(lozcu%k5@7@5d@d)8^0mn=s1fzh^4v65'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = ['localhost', 'djangoshop.local']


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'django_extensions',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'djangoshop.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'djangoshop.wsgi.application'


# Database
# https://docs.djangoproject.com/en/1.11/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
    }
}


# Password validation
# https://docs.djangoproject.com/en/1.11/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/1.11/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_L10N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/1.11/howto/static-files/

STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, "assets/dist")
#STATICFILES_DIRS = [
#    os.path.join(BASE_DIR, "static")
#]

MEDIA_ROOT = os.path.join(BASE_DIR, "media")
MEDIA_URL = '/media/'
ADMIN_MEDIA_PREFIX = '/media/admin/'

```

Next you need to update your hosts file to allow accessing `djangoshop.local`
- Windows

```
C:\Windows\system32\Drivers\etc\hosts
```

- macOS / Linux

```
/etc/hosts
```

Add the following entry to the bottom of the file:

```
127.0.0.1	djangoshop.local
```

## Installing packages
Make sure that you are in the virtual environment. From your `~/Code/djangoshop` directory run `source bin/activate` on macOS/Linux and on Windows run `.\Scripts\activate`
If you are using `Powershell` on Windows, please make sure that your execution policy is set to `RemoteSigned`.

Now that we are inside our virtual environment, we have to install the `python` and `NodeJS` packages that we need.
First run `pip install -r src/requirements.txt` and wait for it to complete.
Next run `npm install` to install the `NodeJS` packages needed for asset compilation.

Next we need to run migrations to prepare the database. Make sure that you are in the `src` folder and then run `python manage.py migrate`
This will create a local sqlite3 database that can be used for development and testing.

Now create a superuser, so that you can log in to the admin sectin of the application. This is done using `python manage.py createsuperuser`

If you have done everything correctly, then you should be able to access the application at `http://djangoshop.local:8000` or `http://localhost:8000` by running `python manage.py runserver`

## UML Diagrams
If for some reason you need to regenerate the UML-diagram for the application this can be done with the following command from within the src folder:

```
python manage.py graph_models -a -o djangoshop.png
```

This will generate a new UML-diagram and save it has `djangoshop.png`
